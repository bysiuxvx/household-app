version: 1.0
runtime: nodejs18

build:
  commands: |
    corepack enable
    corepack prepare pnpm@8.15.0 --activate
    pnpm install --frozen-lockfile
    pnpm --filter backend... run prisma:generate
    pnpm --filter "./packages/**" run build --if-present
    pnpm --filter backend... run build

run:
  command: pnpm --filter backend... run start:prod
  network:
    port: 8080
  runtime_environment_variables:
    NODE_ENV: production
    PORT: '8080'
    HOST: '0.0.0.0'
    # Uncomment and set these values in the AWS App Runner console
    # DATABASE_URL: your-database-url
    # CLERK_PUBLISHABLE_KEY: your-clerk-publishable-key
    # CLERK_SECRET_KEY: your-clerk-secret-key
