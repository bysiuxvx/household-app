version: 1.0
runtime: nodejs18

build:
  commands:
    - corepack enable
    - corepack prepare pnpm@8.15.0 --activate
    # Install all workspace deps (dev deps included so prisma CLI is available)
    - pnpm install --frozen-lockfile
    # Generate prisma client for backend
    - pnpm --filter backend... run prisma:generate
    # Run database migrations
    - pnpm --filter backend... run prisma:migrate:deploy
    # Build shared packages
    - pnpm --filter "./packages/**" run build --if-present
    # Build backend TypeScript
    - pnpm --filter backend... run build

run:
  command: pnpm --filter backend... run start:prod
  network:
    port: 3000
